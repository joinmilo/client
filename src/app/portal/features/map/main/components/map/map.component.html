<div class="{{(isLandscape | async) ? 'landscape' : ''}} {{(isDesktop | async) ? 'desktop' : ''}} {{showMenuInDesktop ? '' : 'hide-menu' }}">
  <div class="map-menu">
    <div class="map-menu-head">
      <div>
        <div *ngIf="(results | async) as results">
          {{ results.count }}
          <span *ngIf="results.count !== 1" [appLabel]="results.labelPlural"></span>
          <span *ngIf="results.count === 1" [appLabel]="results.label"></span>
        </div>
      </div>

      <button mat-raised-button (click)="showFilter = !showFilter">
        <fa-icon [icon]="['fas', 'filter']"></fa-icon>
        <span appLabel="Filter"></span>
      </button>
    </div>

    <div class="map-filter" *ngIf="showFilter && (activeFilter | async) as filter">
      <div *ngIf="filter === FilterKey.events">
        <app-portal-map-event-filter></app-portal-map-event-filter>
      </div>
      <div *ngIf="filter === FilterKey.organisations">
        <app-portal-map-organisation-filter></app-portal-map-organisation-filter>
      </div>
      <div *ngIf="filter === FilterKey.deals">
        <app-portal-map-deal-filter></app-portal-map-deal-filter>
      </div>
    </div>

    <ng-template *ngIf="isDesktop | async; then resultList"></ng-template>
  </div>

  <div class="map-container">
    <div leaflet
         (leafletMapReady)="onMapReady($event)"
         (leafletMapMoveEnd)="onMapPositionChange()"
         (leafletMapZoomEnd)="onMapPositionChange()"
         [leafletOptions]="leafletOptions"
         [leafletFitBounds]="(mapBounds | async)!">
      <div *ngIf="(markers | async) as markers"
           [leafletMarkerCluster]="markers"
           [leafletMarkerClusterOptions]="markerClusterOptions"></div>
    </div>

    <app-map-attribution></app-map-attribution>

    <button mat-mini-fab *ngIf="isDesktop | async" (click)="toggleMenu()">
      <fa-icon icon="angle-left"></fa-icon>
    </button>

    <mat-button-toggle-group (change)="setFilter($event.value)" [value]="activeFilter | async" name="filter">
      <mat-button-toggle [value]="FilterKey.events"><span appLabel="events"></span></mat-button-toggle>
      <mat-button-toggle [value]="FilterKey.organisations"><span appLabel="organisations"></span></mat-button-toggle>
      <mat-button-toggle [value]="FilterKey.deals"><span appLabel="deals"></span></mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <ng-template *ngIf="(isDesktop | async) === false; then resultList"></ng-template>
</div>

<ng-template #resultList>
  <app-map-card-list
    *ngIf="(results | async) as results"
    [entity]="results.entity"
    [cards]="results.data"
    [pageSize]="(isDesktop | async) ? 8 : 4">
  </app-map-card-list>
</ng-template>
